<!-- БЛОК УПРАВЛЕНИЯ ПОЛЬЗОВАТЕЛЯМИ -->
<div class="row">
    <!-- ЛЕВАЯ ПАНЕЛЬ: НОВЫЙ ПОЛЬЗОВАТЕЛЬ -->
    <div class="col-md-4">
        <div class="panel panel-primary panel-shadow">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="glyphicon glyphicon-plus"></i> Новый пользователь</h3>
            </div>
            <div class="panel-body">
                <form action="{{ url_for('service.add_user') }}" method="POST">
                    <div class="form-group">
                        <label>Логин:</label>
                        <input type="text" name="username" class="form-control" placeholder="напр.: SemenovRS" required>
                    </div>
                    <div class="form-group">
                        <label>ФИО:</label>
                        <input type="text" name="full_name" class="form-control" placeholder="напр.: Семенов Р.С." required>
                    </div>
                    <div class="form-group">
                        <label>Категория работника:</label>
                        <select name="role_name" class="form-control" required>
                            <option value="" disabled selected>Выберите роль...</option>
                            {% for r in roles %}
                                <option value="{{ r[0] }}">{{ r[0] }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <p class="help-block small">Пароль по умолчанию: <strong>qwerty123</strong></p>
                    <button type="submit" class="btn btn-success btn-block">
                        <i class="glyphicon glyphicon-ok"></i> Создать пользователя
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- ПРАВАЯ ПАНЕЛЬ: СПИСОК ДОСТУПА -->
    <div class="col-md-8">
        <div class="panel panel-default panel-shadow">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="glyphicon glyphicon-user"></i> Доступ к системе</h3>
            </div>
            <div class="table-responsive">
                <table class="table table-hover" style="margin-bottom: 0;">
                    <thead>
                        <tr>
                            <th>Логин</th>
                            <th>ФИО</th>
                            <th>Категория</th>
                            <th class="text-center">Статус</th>
                            <th class="text-right">Действия</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for u in users %}
                        <tr class="{{ 'text-muted' if u[4] == 0 }}">
                            <td><code>{{ u[1] }}</code></td>
                            <td>{{ u[2] }}</td>
                            <td><span class="label label-default">{{ u[3] }}</span></td>
                            <td class="text-center">
                                {% if u[4] == 1 %}
                                    <span class="status-active" title="Активен"><i class="glyphicon glyphicon-ok-circle"></i></span>
                                {% else %}
                                    <span class="status-disabled" title="Отключен"><i class="glyphicon glyphicon-ban-circle"></i></span>
                                {% endif %}
                            </td>
                            <td class="text-right">
                                <form action="{{ url_for('service.user_action') }}" method="POST" style="display:inline;">
                                    <input type="hidden" name="username" value="{{ u[1] }}">
                                    
                                    <button type="submit" name="action" value="reset" class="btn btn-warning btn-xs" title="Сбросить пароль/Активировать">
                                        <i class="glyphicon glyphicon-refresh"></i>
                                    </button>
                                    
                                    {% if u[4] == 1 %}
                                    <button type="submit" name="action" value="deactivate" class="btn btn-danger btn-xs" 
                                            onclick="return confirm('Отключить доступ пользователю {{ u[1] }}?')" title="Отключить">
                                        <i class="glyphicon glyphicon-off"></i>
                                    </button>
                                    {% endif %}
                                </form>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% if not users %}
            <div class="panel-body text-center text-muted">
                <em>Пользователи еще не созданы</em>
            </div>
            {% endif %}
        </div>
    </div>
</div>

